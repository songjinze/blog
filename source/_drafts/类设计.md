---
title: 类设计
tags: OO
categories: OO
---

# 类设计

## 抽象数据类型（ADT）

类的基础实际上是抽象数据类型。
抽象数据类型指一组数据以及对这些数据所进行的操作的集合。ADT使得可以像现实世界一样操作实体，而不必关注底层实现细节。

### ADT的优点

* 可以隐藏实现细节
* 改动不会影响到整个程序
* 让接口提供更多的信息
* 更容易提高性能
* 让程序的正确性更显而易见
* 程序更具自我说明性
* 无需在程序内到处传递数据
* 可以像现实世界中那样操作实体

ADT构成了类概念的基础。

## 什么是类？

类是一组数据和子程序的集合，这些数据和子程序共同拥有一组内聚的、明确定义的职责。  
类也可以是一组子程序集合，提供一组内聚的服务。  
  
本质上来说：
* 从数据角度，ADT和类没有什么区别。
* 从OO角度，类还涉及到面向对象中的概念。
  
在类中对应的区别于ADT的体现在于：
* 隐藏私有信息
* 封装性
* 真正意义的接口
* 更易于修改
* 易于识别错误
* 可读性高
* 封装数据和操作
* 更接近人的思维  

类可以看作是ADT再加上继承和多态两个概念。

## 类接口的设计

类设计的第一步，也是最重要的一步。

### 类接口设计建议

1. 好的抽象。类的接口应能提供一组明显相关的子程序。
2. 好的封装。不要暴露自身数据和实现细节。

#### 好的抽象

* 类接口应该尽量展现一致的抽象层次。  
每一个类应该实现并仅实现一个ADT。  
当实现了多个ADT时，可以考虑重新组织类。  
* 理解类接口应该捕获的抽象到底是哪一个。
* 提供成对的服务，不要盲目创建相反操作。
* 把不相关的信息转移到其它类。思考子程序与数据之间的引用关系。
* 让接口可编程，而不是表达语义。  
可编程部分： 接口数据类型+其他属性，编译器可检查。  
语义部分： 本接口将会被怎样使用，编译器不可检查。  
* 不要添加与接口抽象不一致的公用成员。
* 同时考虑抽象性和内聚性。

#### 好的封装

* 封装比抽象更严格，二者相辅相成。抽象提供可以忽略实现细节的模型来管理复杂度，而封装阻止你看到细节。
* 尽可能限制类和成员的可访问性。采用最严格且可行的访问级别。最好地保护接口抽象地完整性。
* 不要公开暴露成员数据
* 避免把私有实现细节放到类接口中
* 不要对类地使用者做任何假设
* 避免使用友元类
* 不要因为一个子程序只使用公用子程序，就把它归入公开接口
* 让阅读代码比编写代码更方便
* 警惕从语义上破坏封装性

### 留意过于紧密的耦合关系

* 尽可能限制类和成员的可访问性
* 避免友元类，因其之间是紧密耦合的
* 在基类中把数据声明为private而不是protected，以降低派生类和基类的耦合度
* 避免在类的公开接口中暴露成员数据
* 要对从语义上破坏封装性保持警惕
* 警觉“Demeter”法则

## 包含关系设计

包含关系实现的是“has a”的关系。
* 警惕超过7个数据成员的类

## 继承关系的设计

继承表示一个类是另一个类的实例。目的是写出更精简的代码，避免重复。
* 继承关系应该遵循里氏替换原则！

慎用继承，在子类只覆盖基类方法时应该使用组合。
