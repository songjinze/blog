---
title: 指针
tags: Cpp/C
categories: Cpp/C
date: 2019-01-20 16:40:31
---


# 指针

指针这个概念不是C或Cpp特有的，但实际上我们常常在其中使用。“什么是指针”是一个很简单的问题，但其实针对于指针还是有很多要注意的地方。在这里略加总结一下。

## 什么是指针？

计算机科学中，指针是一种最简单形式的引用。指针实际上是一个数据类型。  
  
为什么这么说呢，从汇编的角度看，汇编语言针对计算机底层硬件进行操作，并没有区分数据类型，只有数据所占内存空间的大小。要么操作寄存器，要么操作内存地址。  
  
C语言在汇编之上升级为“中级语言”，但是保留了汇编语言的一部分特性。对比一下像java这样的高级语言，C语言可以直接对内存地址进行操作（或寄存器），同时C语言也可以声明自己的数据类型，因此必须要对内存地址这个数据类型加以区分，这就是指针的基本含义。  

### 指针的操作

#### 传指针

```C
#include <stdio.h>
void inc(int * val){
    (*val)++;
}
int main(){
    int a=3;
    inc(&a);
    printf("%d\n",a);
    return 0;
}
```

output 4  

由于C中函数的操作在栈中进行，因此在弹栈时并不会保存栈中返回值以外的值。如果想通过函数来改变参数的值，我们需要传指针。  

#### 双重指针

双重指针其实就是指向指针的指针。这个指针指向某个内存地址，内存地址的值是一个指针，指向另一个内存地址。如果我们把指针看作一个数据类型，那么其实双重指针就可以看作是指向的数据类型是指针的数据类型。  
为了防止指针被乱用，可以规定指针类型为强类型，即指针值及保存在该内存地址的对象的类型。

#### 指针数组

保存指针的数组。

#### 数组指针

这里分为两种情况：
* 数组名出现在表达式中，绝大多数情况会被隐式转换为指向数组的首个元素的指针右值。
* 数组名作为sizeof的操作数或者作为取地址&元素符的操作数，表达式的值为指向整个数组的指针右值。  

举个例子：
```C
char s[]="hello";
int main(){
    char (*p)[6]=&s; //accept
    char(*p2)[6]=s;  //compile error: cannot convert 'char*' to 'char (*)[6]'   
    char *p3=&s;  //compile error: cannot convert 'char (*)[6]' to 'char*' 
}
```

#### 指向函数的指针

指向函数的指针是指向了一段可执行的代码的首地址，这段代码占用一段内存空间。在这个层面上，实际上C语言完全可以成为面向对象的语言，只是表述起来比较麻烦。但是只要稍加规定，C可以通过面向对象的方式组织自己的代码。

举个例子：
```C
#include<stdio.h>
void inc(int *val){
    (*val)++;
}

int main(void){
    void (*fun)(int *);  //声明函数指针
    int a=3;
    fun=inc;  //对函数指针进行赋值
    (*fun)(&a);  //使用函数指针进行函数调用
    printf("%d",a);
    return 0;
}
```

#### 指针运算符的重载

利用C++的运算符重载对指针运算符进行重载。

## 指针的现状和未来

指针的活跃性和直接对底层操作导致了它可以在几乎不受限制的情况下进行各种存储器地址间的活动。稍加不慎就会造成重复、重叠、溢出等情况。这种情况下直接导致程序甚至计算机的崩溃。实际上现在的高级语言要么取消了指针的使用（虽然你可以间接地通过语言的某些性质进行类似指针的操作），但这些语言都避开了指针的直接无限制使用带来的危害。  
但是不可否认，如果追求性能，指针的操作是对程序性能提升的最底层的操作，也是性能优化的终点。