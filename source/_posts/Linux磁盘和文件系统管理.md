---
title: Linux磁盘和文件系统管理
date: 2018-11-22 23:42:09
tags: 课程学习
categories: Linux
---

# Linux磁盘和文件系统管理

在Linux系统中，如果需要在某个磁盘上存储数据，则需要将磁盘进行分区，创建文件系统，最后将文件系统挂载到目录下才可以。为了控制文件和目录的访问，可以设置文件和目录的访问权限，甚至可以更改文件和目录的所有权。

## Linux硬盘分区

### 硬盘分区知识

#### 什么是硬盘分区？

分区就是硬盘的“段落”，如果用户希望在计算机上安装多个操作系统，将需要更多的分区。假设要同时安装Windows XP和Windows 7，那么需要两个分区，原因是不同的操作系统原则上采用不同的文件系统。

#### 分区类型

硬盘分区一共有3种：主分区、扩展分区和逻辑分区。

#### 分区的格式化

不同的操作系统具有不同的硬盘分区工具，Windows系统下非常有名的分区工具是fdisk，在Linux系统下进行分区可以使用fdisk，或者使用相同功能的图形界面程序。每个主分区和逻辑分区都会被存储为一个识别文件系统的附加信息。通过分区当然不能产生任何文件系统。分区必须要进行格式化。

### 使用fdisk进行硬盘分区

Linux系统使用fdsik命令能将磁盘划分成为若干个区，同时也能为每个分区指定分区的文件系统，比如ext3，ext4，FAT 32， SWAP，FAT 16以及其他类UNIX操作系统的文件系统等。

#### fdisk的介绍

使用fdisk命令可以对磁盘进行分区。   
命令语法：   
fdisk [-b <分区大小>][-uv][磁盘设备名]   
fdisk [-l][-b <分区大小>][-uv][磁盘设备名] fdisk [-s <分区编号>]

fdisk命令参数  

|子命令|含义|
|---|---|
|m|显示所有在fdisk中使用的命令|
|p|显示硬盘分区信息|
|a|设置硬盘启动区|
|n|创建新的分区|
|e|创建扩展分区|
|p|创建主分区|
|t|更改分区文件系统|
|d|删除硬盘分区|
|q|退出fdisk，不保存硬盘分区设置|
|w|保存硬盘分区设置并退出fdisk|

#### Linux系统下硬盘分区举例

1. 进入fdisk界面，列出所有命令。
2. 显示硬盘分区信息
3. 创建和删除主分区。
4. 创建扩展分区和逻辑驱动器
5. 查看并转换文件系统。
6. 保存分区设置信息，并退出fdisk。
7. 在非交互式界面下显示当前硬盘的分区信息。

## Linux文件系统简介

文件系统通过为每个文件分配文件块的方式把数据存储在存储设备中，这样就要维护每一个文件的文件块的分配信息，而分配信息本身也要存在磁盘上，不同的文件系统用不同的方法分配和读取文件块。

### Linux文件系统的工作原理

有两种常用的文件系统的分配策略：块分配和扩展分配。块分配是当文件变大的时候每一次都为这个文件分配磁盘空间，而扩展分配则是当某个文件的磁盘空间不够的时候，一次性为它分配一连串连续的块。  
传统的UNIX文件系统使用的块分配的机制提供了一个灵活而高效的文件块分配策略。  
可以通过优化文件块的分配策略（尽可能 为文件分配连续的块）来避免文件块的随机分配。   
每一次当文件扩展的时候，块分配的算法就要写入一些关于新分配的块所在位置的信息。

### Linux主流文件系统

文件系统是指文件在硬盘上的存储方法和排列顺序。在Linux系统中，每个分区都是一个文件系统，都有自己的目录层次结构。   
Linux系统最重要特征之一就是支持多种文件系统，这样它更加灵活，并可以和许多其他操作系统共存。   
虚拟文件系统使得Linux可以支持多个不同的文件系统。   
随着Linux系统的不断发展，它所支持的文件格式系统也在迅速扩充。  
下面介绍Linux系统最常用的几种文件系统。  
1. ext3
2. ext4
3. JFS
4. PeiserFS
5. XFS  
其他文件系统：  
1. Minix
2. Xia
3. ISO9660
4. NFS
5. SysV
6. VFAT

## 创建文件系统

如果要加载一个分区，首先需要确认文件系统的类型，然后才能挂载使用，比如通过mount加载或者通过修改/etc/fstab文件开机自动加载都可以实现该功能。

### 创建文件系统简介

对一个新的硬盘进行分区以后，还要对这些分区进行格式化并创建文件系统。一个分区只有建立了某种文件系统后，这个分区才能使用。建立文件系统的过程，就是用相应格式化工具格式化分区的过程，这个过程和在Windows系统中格式化某个分区为NTFS分区的过程类似。  
Linux系统支持目前主流的文件系统，如VFAT，ext3，ext4，ReiserFS，ISO 9660和SWAP交换分区等。如果在计算机上新增加了一 块硬盘，需要格式化成Linux的文件系统，最好选择ext3或ext4文件系统。  
如果需要使用某个文件系统存放数据，一般要经过以下操作步骤。  
1. 使用fdisk命令在硬盘上创建分区。  
2. 使用mkfs命令在分区上创建文件系统。  
3. 使用mount命令挂载文件系统，或修改/etc/fstab文件使得开机自动挂载文件系统。  
4. 使用umount卸载文件系统。

#### 使用mkfs命令创建文件系统

使用mkfs命令可以在分区上建立各种文件系统。   
命令语法：   
mkfs -t [ 文件系统类型 ] [ 磁盘设备名 ]

#### 使用其他命令创建文件系统

## 挂载和卸载文件系统

使用mount和umount命令可以实现挂载和卸载功能，这样用户才可以使用相应的设备存储数据。

### 挂载文件系统

使用mount命令可以将某个分区、光盘、软盘或是U盘挂载到Linux系统的目录下。  
命令语法：   
mount [ 选项 ] [ 设备名称 ] [ 挂载点 ]

### 卸载文件系统

使用umount命令可以将某个分区、光盘、软盘或是U盘进行卸载。   
命令语法：   
umount [ 选项 ] [ -t <文件系统类型> ] [ 文件系统 ]

### 查看分区挂载情况

要查看Linux系统分区挂载情况，除了可以使用df命令之外，还可以通过mount –s命令以及查看/etc/mtab文件获取信息。

## 设置开机自动挂载文件系统

将某个分区或是设备挂载了以后才能使用，但是当计算机重新启动以后，又需要重新挂载，这个时候可以通过修改/etc/fstab文件实现开 机自动挂载文件系统。  

### /etc/fstab文件简介

/etc/fstab文件是一个配置文件，它包含了所有分区以及存储设备的信息。其中包含了磁盘分区和存储设备如何挂载，以及挂载在什么地方的信息。  
如果在Linux系统中不能访问Windows的分区，或者作为一名普通用户，不能挂载光驱和向软盘中写入数据，或者在管理CD-RW的过程中遇到了问题，就有可能是错误地配置了/etc/fstab文件，通常可以通过编辑 /etc/fstab这个文件来解决前面提到的问题。  
/etc/fstab文件是一个简单的文本文件，可以用任何文本编辑器去编辑它，但是必须要以root用户登录才可以编辑该文件。  

### /etc/fstab文件详解

由于每台计算机系统的分区和设备属性不同，所以/etc/fstab文件也不一样，但是基本的结构总是相似的。下面就是其中的一行：   
/dev/sda5    /mnt/kk    ext4     defaults     0     0   
每1行包含着1个设备或分区的信息，每1行又有多个列的信息。第1列是设备名或者设备UUID号，第2列是它的挂载点，第3列是它的文件系统格式，第4列是挂载参数，第5列是转储选项，第6列是文件系统检查选项。
1. 设备  
使用设备名称或设备UUID号表示都可以。如果要查看某设备的UUID号，可以用下面命令：   
ls –l /dev/disk/by-uuid 或 blkid   
2. 挂载点  
Linux系统为每个设备或分区设定了挂载目录。   
3. 文件系统格式  
Linux系统为每个设备或分区指定了文件系统格式。
4. 挂载参数  
（1）auto和noauto   
（2）user和nouser   
（3）exec和noexec   
（4）ro   
（5）rw   
（6）sync和async   
（7）defaults  
5. 转储选项  
dump选项检查文件系统并用一个数字来决定该文件系统是否需要备份。如果它是0，dump将会忽略该文件系统，不做备份。   
6. 文件系统检查选项  
fsck选项通过检验第6项中的数字来决定以何种顺序检查文件系统，如果它是0，fsck将不检查该文件系统。根文件系统（“/”）的默认值为1，其他文件系统可以为2-9。  

## 使用交换空间

Linux系统中的交换空间在物理内存被用完时使用。如果系统需要更多的内存资源，而物理内存已经用完，内存中不活跃的页就会被转移到交换空间中。虽然交换空间可以为具有少量内存的计算机提供帮助，但是这种方法不应该被当作是对内存的取代。交换空间位于硬盘驱动器上，它比进入物理内存要慢。  

### 添加交换空间

有时，用户需要在安装Linux系统后添加更多的交换空间。用户可以添加一个交换分区或添加一个交换文件，推荐使用添加一个交换分区。交换空间可以是一个专用的交换分区， 也可以是一个交换文件，或是两者的结合。交换空间总的大小至少为计算机内存的1～2倍。  

## 权限设置


